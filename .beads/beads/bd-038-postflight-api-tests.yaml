id: bd-038
type: task
title: P1 Sticky - Post-Flight API Validation Tests
description: |
  After the AgentiCorp container starts, we need automated tests that validate
  all documented APIs are responding correctly. This ensures the system is
  fully operational before accepting work.

  Problem Statement
  - No automated verification that APIs are working after container startup
  - Manual testing is error-prone and time-consuming
  - Regressions in API endpoints may go unnoticed until production use

  Scope
  Post-flight tests should validate all APIs documented in README.md:

  Health Check
  - GET /api/v1/health - Returns 200 with status

  Agents
  - GET /api/v1/agents - Returns list of agents
  - POST /api/v1/agents - Creates new agent (test with mock data)
  - GET /api/v1/agents/{id} - Returns specific agent

  Beads (Work Items)
  - GET /api/v1/beads - Returns list of beads
  - POST /api/v1/beads - Creates new bead
  - GET /api/v1/beads/{id} - Returns specific bead
  - PUT /api/v1/beads/{id} - Updates bead

  Decisions
  - GET /api/v1/decisions - Returns list of decisions

  Projects
  - GET /api/v1/projects - Returns list of projects
  - GET /api/v1/projects/{id} - Returns specific project
  - POST /api/v1/projects/{id}/close - Closes project
  - POST /api/v1/projects/{id}/reopen - Reopens project

  Work Graph
  - GET /api/v1/work-graph?project_id={id} - Returns dependency graph

  Events
  - GET /api/v1/events/stats - Returns event statistics
  - GET /api/v1/events/stream - SSE endpoint responds (connection test only)

  Org Charts
  - GET /api/v1/org-charts/{projectId} - Returns org chart for project

  Providers
  - GET /api/v1/providers - Returns list of providers

  Implementation
  - Shell script using curl for HTTP requests
  - jq for JSON parsing and validation
  - Exit codes indicate pass/fail for CI integration
  - Colorized output for human readability
  - Timeout handling for hung endpoints
  - Summary report at end

  Acceptance Criteria
  - [ ] Test script created at tests/postflight/api_test.sh
  - [ ] All documented endpoints tested
  - [ ] Each test validates response code and basic structure
  - [ ] Script exits 0 on success, non-zero on any failure
  - [ ] Makefile target: make test-api
  - [ ] Can run against localhost:8080 or custom BASE_URL
  - [ ] Tests clean up any resources they create
  - [ ] Documentation updated with test instructions

  Sticky Behavior
  This bead is marked sticky - it should be re-validated on every container
  startup and after any API changes. The post-flight tests act as a smoke
  test to ensure the system is ready to accept work.

status: open
priority: 1
project_id: agenticorp
assigned_to: null
blocked_by: []
blocks: []
parent: null
children: []
tags:
  - p1
  - sticky
  - testing
  - api
  - post-flight
  - validation
is_sticky: true
created_at: 2026-01-20T06:00:00Z
updated_at: 2026-01-20T06:00:00Z
context:
  source: user-request
  rationale: |
    Post-flight tests ensure the AgentiCorp system is fully operational
    after startup. Running these tests automatically catches regressions
    and configuration issues before they impact users.
