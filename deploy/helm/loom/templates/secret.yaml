{{- if not .Values.loom.existingSecret }}
# Loom admin credentials
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "loom.fullname" . }}-secret
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "loom.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  # Override in production: helm install ... --set loom.existingSecret=my-secret
  # or create the secret with: make helm-secrets
  password: "loom-default-password"
{{- end }}
---
{{- if not .Values.postgresql.auth.existingSecret }}
# PostgreSQL credentials shared between loom + pgbouncer
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "loom.fullname" . }}-postgresql-secret
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "loom.labels" . | nindent 4 }}
  annotations:
    helm.sh/resource-policy: keep
type: Opaque
stringData:
  username: {{ .Values.postgresql.auth.username | quote }}
  password: {{ .Values.postgresql.auth.password | quote }}
{{- end }}
